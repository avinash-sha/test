---
- name: Run PowerShell script on remote VM and copy file to local
  hosts: windows_vm
  gather_facts: no
  tasks:
    - name: Run PowerShell script
      win_shell: C:\Users\cvadmin\Documents\gen-inventory.ps1
      register: script_output

    - name: Fetch the file generated by the script
      fetch:
        src: C:\Users\cvadmin\Desktop\inventory.ini
        dest: /home/semaphore/inventory.ini
        flat: yes
